<!-- -->
<launch>

    <arg name="vehicle_name" default="mkz"/>
    <arg name="android-dt" default="$(find cooperation_setup)/"/>
    <arg name="origin_fix" default="[37.918506, -122.332904,0.0]"/>

    <group ns="$(arg vehicle_name)">

        <node pkg="cooperation_setup" type="android_setup" name="android_setup" output="log">
            <param name="ifpath" value="$(arg android-dt)/"/>
<!--
            <param name="date" value="2019-12-16"/>
-->
        </node>

        <group ns="gnss_localizer">
            <node pkg="cooperation_setup" name="nmea2fix" type="nmea2fix">
                <remap from="nmea_sentence" to="/mkz/nmea_sentence"/>
                <param name="vehicle_name" value="mkz"/>
            </node>
            <node pkg="cooperation_setup" name="fix2pose" type="fix2pose">
                <rosparam param="origin_fix" subst_value="True">$(arg origin_fix)</rosparam>
                <remap from="pose" to="pose_raw"/>
            </node>
            <node pkg="path_follower" name="pose_estimation" type="pose_estimation">
                <remap from="vehicle/twist" to="/mkz/vehicle/twist"/>
                <remap from="xsens/imu/data" to="/mkz/xsens/imu/data"/>
                <remap from="gnss_pose" to="pose_raw"/>
            </node>
            <node pkg="path_follower" name="state_estimation" type="state_estimation.py">
                <remap from="vehicle/twist" to="/mkz/vehicle/twist"/>
                <remap from="xsens/imu/data" to="/mkz/xsens/imu/data"/>
                <param name="base_link" value="mkz/gps"/>
                <param name="tf_publish" value="true"/>
            </node>
        </group>
        
        <include file="$(find lidar_apollo_cnn_seg_detect)/launch/lidar_apollo_cnn_seg_detect.launch">
            <arg name="points_src" value="points_raw"/>
            <arg name="output" value="log"/>
        </include>
        <include file="$(find lidar_imm_ukf_pda_track)/launch/imm_ukf_pda_track.launch">
            <arg name="tracking_frame" value="/odom"/>
            <arg name="output" value="log"/>
        </include>

        <node pkg="tf2_ros" type="static_transform_publisher" name="vehicle_to_gps"
              args="1. 0. 0. 0. 0. 0. mkz/gps mkz/base_link" required="true"/>
        <node pkg="tf2_ros" type="static_transform_publisher" name="vehicle_to_xsens"
              args="0. 0. 0. 0. 0. 0. mkz/base_link mkz/xsens" required="true"/>
        <node pkg="tf2_ros" type="static_transform_publisher" name="vehicle_to_lidar"
              args="0. 0. 0. 0. 0. 0. mkz/base_link mkz/velodyne" required="true"/>

    </group>


</launch>
